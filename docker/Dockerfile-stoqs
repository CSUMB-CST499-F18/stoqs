FROM mbari/stoqs-base:0.0.1

ARG STOQSADM_PASS

# TODO perhaps no need to copy everything for a production env.
COPY stoqs  /opt/stoqsgit/stoqs/

ENV STOQS_HOME=/opt/stoqsgit \
    DATABASE_URL="postgis://stoqsadm:${STOQSADM_PASS}@stoqs-postgis:5432/stoqs" \
    PATH=/usr/pgsql-9.6/bin:${PATH}

# The following mainly in case the container is run with bash as entry point
RUN echo -e "\n\
# ======= STOQS =======\n\
alias psql='psql --host=stoqs-postgis --port=5432'\n\
" >> /root/.bashrc

WORKDIR    /opt/stoqsgit
ENTRYPOINT ["stoqs/manage3.6.py", "runserver", "0.0.0.0:8000", "--settings=config.settings.local"]
